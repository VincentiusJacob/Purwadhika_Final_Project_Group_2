version: "3.9"
services:
  # 1. BACKEND (FastAPI + LangGraph Logic)
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: agent-backend
    command: ["uvicorn", "api.app:app", "--host", "0.0.0.0", "--port", "8000"]
    ports:
      - "8000:8000"
    env_file: .env

  # 2. FRONTEND (Streamlit)
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: agent-frontend
    command:
      [
        "streamlit",
        "run",
        "app.py",
        "--server.port=8501",
        "--server.address=0.0.0.0",
      ]
    ports:
      - "8501:8501"
    env_file: .env
    environment:
      - BACKEND_URL=http://backend:8000
    depends_on:
      - backend

  # 3. VOICE AGENT (LiveKit Worker)
  interview-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: agent-voice-worker
    command: ["python", "agents/interview_agent.py", "dev"]
    env_file: .env
